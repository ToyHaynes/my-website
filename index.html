<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>A&R+ | Drum Exercise Generator</title>
    <style>
        :root {
            --bg-color: #423e37;
            --text-color: #edebd7;
            --primary-color: #e3b23c;
            --neutral-light: #a39594;
            --neutral-dark: #6e675f;
            --white: #ffffff;
            --char-width: 22px; 
            --gap-width: 22px;
            --measure-gap: 44px;
        }
        * { box-sizing: border-box; }
        body {
            font-family: 'Courier New', Courier, monospace;
            background-color: var(--bg-color);
            color: var(--text-color);
            padding: 20px;
            display: flex;
            justify-content: center;
        }
        h2 {
            color: var(--text-color);
            font-family: sans-serif;
            text-align: center;
        }
        h3 {
            color: var(--primary-color);
            font-family: sans-serif;
            border-bottom: 1px solid var(--neutral-dark);
            padding-bottom: 8px;
        }
        .container {
            width: fit-content;
            margin: 0 auto;
        }
        .controls {
            margin-top: 15px;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
        }
        .control-btn {
            background-color: var(--neutral-dark);
            border: 1px solid var(--neutral-light);
            color: var(--text-color);
            padding: 8px 16px;
            margin-right: 10px;
            cursor: pointer;
            border-radius: 4px;
            transition: all 0.2s ease-in-out;
        }
        .control-btn:hover {
            border-color: var(--primary-color);
            color: var(--primary-color);
        }
        .control-btn.active {
            background-color: var(--primary-color);
            border-color: var(--primary-color);
            color: var(--bg-color);
        }
        .control-select {
            background-color: var(--neutral-dark);
            border: 1px solid var(--neutral-light);
            color: var(--text-color);
            padding: 7px;
            border-radius: 4px;
            margin-left: auto;
        }
        .download-section {
            margin-top: 30px;
            padding-top: 20px;
            border-top: 1px solid var(--neutral-dark);
            display: flex;
            align-items: center;
            gap: 15px;
        }
        .filename-input {
            background-color: rgba(0, 0, 0, 0.2);
            border: 1px solid var(--neutral-light);
            color: var(--text-color);
            padding: 8px;
            border-radius: 4px;
            font-family: sans-serif;
            flex-grow: 1;
        }
        #input-staff {
            display: grid;
            grid-template-columns: repeat(4, auto);
            gap: var(--measure-gap);
            border: 2px solid var(--neutral-dark);
            background-color: rgba(0, 0, 0, 0.2);
            border-radius: 5px;
            margin-bottom: 30px;
            padding: 20px;
        }
        .measure {
            display: flex;
            position: relative;
            width: calc(8 * var(--char-width) + var(--gap-width));
        }
        .measure:not(:last-child)::after {
            content: ''; position: absolute; height: 70%; width: 2px;
            background-color: var(--primary-color);
            top: 15%;
            right: calc( (var(--measure-gap) / -2) - 1px );
        }
        .note-container {
            position: relative; width: var(--char-width); height: 80px; cursor: pointer;
        }
        .measure .note-container:nth-child(4) {
            margin-right: var(--gap-width);
        }
        .note-head {
            width: 14px; height: 11px; background-color: var(--text-color); border-radius: 50%;
            transform: rotate(-15deg); position: absolute; top: 50px;
            left: calc(50% - 7px);
        }
        .note-stem {
            position: absolute; width: 2px; height: 35px; background-color: var(--text-color);
            left: calc(50% + 5px);
            top: 18px;
            transition: background-color 0.2s;
        }
        .beam {
            position: absolute; height: 4px; background-color: var(--text-color); top: 18px;
        }
        .beam.first-group {
            width: calc(3 * var(--char-width));
            left: calc(var(--char-width) / 2 + 5px);
        }
        .beam.second-group {
            width: calc(3 * var(--char-width));
            left: calc(4 * var(--char-width) + var(--gap-width) + var(--char-width) / 2 + 5px);
        }
        .accent-mark {
            position: absolute; top: 0px ;left: 5px; font-size: 24px; font-weight: bold;
            color: var(--primary-color);
            opacity: 0; transition: opacity 0.2s;
            width: 100%; text-align: center;
        }
        .note-container.accented .accent-mark { opacity: 1; }
        .note-container.accented .note-head { background-color: var(--primary-color); transform: rotate(-15deg) scale(1.1); }
        .note-container.accented .note-stem {
            background-color: var(--primary-color);
        }
        #output {
            background-color: rgba(0, 0, 0, 0.2); 
            padding: 20px;
            border-radius: 5px;
            width: 100%;
        }
        .sticking-group-container { margin-bottom: 15px; }
        .sticking-group-container .line { white-space: nowrap; line-height: 2.2em; font-size: 16px; }
        .variation-spacer { height: 2em; }
        .note, .sub-spacer, .bar-line { display: inline-block; text-align: center; vertical-align: middle; }
        .note { width: var(--char-width); }
        .sub-spacer { width: var(--gap-width); }
        .bar-line { width: var(--measure-gap); color: var(--primary-color); font-weight: bold; }
        .note.accent { background-color: transparent; color: var(--primary-color); font-weight: bold; text-transform: uppercase; }

        /* YENƒ∞: Ekranda g√∂r√ºnmeyecek olan PDF ba≈ülƒ±ƒüƒ± */
        #print-header {
            display: none;
        }

        @media print {
            body {
                background-color: #fff !important; color: #000 !important; padding: 0.5in !important;
                display: block !important;
            }
            h2, h3:not(.print-title), .controls, #input-staff, .download-section {
                display: none !important;
            }
            .container { width: 100% !important; margin: 0 !important; padding: 0 !important; }
            
            /* YENƒ∞: PDF ba≈ülƒ±ƒüƒ±nƒ± g√∂r√ºn√ºr yap ve stillendir */
            #print-header {
                display: flex;
                justify-content: space-between;
                align-items: baseline;
                border-bottom: 2px solid #000;
                padding-bottom: 10px;
                margin-bottom: 30px;
                font-family: sans-serif;
            }
            #print-header-main { font-size: 18pt; font-weight: bold; }
            #print-header-user { font-size: 14pt; }
            
            #output {
                border: none !important; box-shadow: none !important; width: 100% !important;
                padding: 0 !important; background: transparent !important;
            }
            .sticking-group-container h3 {
                display: block !important; color: #000 !important;
                border-bottom: 1px solid #ccc !important; font-size: 14pt !important;
            }
            .sticking-group-container .line { font-size: 12pt !important; color: #000 !important; }
            .note.accent {
                color: #000 !important; font-weight: bold !important;
                text-decoration: underline; text-decoration-thickness: 2px;
            }
            .bar-line { color: #000 !important; }
        }
    </style>
</head>
<body>
    <div id="print-header"></div>

    <div class="container">
        <h2>ü•Å ACCENTS & REBOUNDS ULTIMATE ü•Å</h2>
        
        <h3>1. Create Melody (Choose Accents):</h3>
        <div class="controls">
            <div>
                <button id="btn-4" class="control-btn active">4 Bar</button>
                <button id="btn-8" class="control-btn">8 Bar</button>
                <button id="btn-12" class="control-btn">12 Bar</button>
            </div>
            <select id="preset-select" class="control-select"></select>
        </div>
        <div id="input-staff"></div>

        <h3>2. Stickings</h3>
        <div id="output"></div>

        <div class="download-section">
            <input type="text" id="pdf-title-input" class="filename-input" placeholder="Enter Exercise Title for PDF...">
            <button id="btn-download-pdf" class="control-btn">Download PDF</button>
        </div>
    </div>

    <script>
    const maxNotes = 96;
    const generateGroupingPattern = (groupSize) => { const pattern = []; for (let i = 0; i < maxNotes; i++) { pattern.push(i % groupSize === 0 ? 1 : 0); } return pattern; };
    const melodyPresets = { "Custom (Clear)": [], "2-Note Grouping": generateGroupingPattern(2), "3-Note Grouping": generateGroupingPattern(3), "4-Note Grouping": generateGroupingPattern(4), "5-Note Grouping": generateGroupingPattern(5), "6-Note Grouping": generateGroupingPattern(6), "7-Note Grouping": generateGroupingPattern(7), };
    const stickingGroups = [ { title: "Single", patterns: { "R": "rlrl", "L": "lrlr" } }, { title: "Double", patterns: { "R": "rrll", "L": "llrr" } }, { title: "Inverted Double", patterns: { "R": "rllr", "L": "lrrl" } }, { title: "Paradiddle", patterns: { "R": "rlrrlrll", "L": "lrllrllr" } }, { title: "Paradiddle Inversion no:1", patterns: { "R": "rllrlrrl", "L": "lrrlrllr" } }, { title: "Paradiddle Inversion no:2", patterns: { "R": "rrlrllrl", "L": "llrllr" } }, { title: "Four Stroke Rolls", patterns: { "R": "rrrrllll", "L": "llllrrrr" } }, { title: "Single Hand Patterns", patterns: { "R": "rrrr", "L": "llll" } } ];
    const notesPerMeasure = 8;
    const notesPerRow = notesPerMeasure * 4;
    let currentTotalMeasures = 4;
    let userAccents = [];
    
    const staffContainer = document.getElementById('input-staff');
    const outputDiv = document.getElementById('output');
    const buttons = [ document.getElementById('btn-4'), document.getElementById('btn-8'), document.getElementById('btn-12') ];
    const presetSelect = document.getElementById('preset-select');
    const btnDownloadPdf = document.getElementById('btn-download-pdf');
    const pdfTitleInput = document.getElementById('pdf-title-input'); // Yeni input
    const printHeader = document.getElementById('print-header'); // Yeni g√∂r√ºnmez div

    function renderExercise() {
        const totalNotes = notesPerMeasure * currentTotalMeasures;
        let finalHtmlOutput = ""; 
        for (const group of stickingGroups) {
            finalHtmlOutput += `<div class="sticking-group-container">`;
            finalHtmlOutput += `<h3 class="print-title">${group.title}</h3>`;
            const patternKeys = Object.keys(group.patterns);
            patternKeys.forEach((key, index) => {
                const stickingPattern = group.patterns[key];
                let fullStickingSequence = "";
                for (let i = 0; i < totalNotes; i++) { fullStickingSequence += stickingPattern[i % stickingPattern.length]; }
                let currentLineHtml = '<div class="line">';
                for (let i = 0; i < fullStickingSequence.length; i++) {
                    const note = fullStickingSequence[i];
                    const noteClass = userAccents[i] === 1 ? "note accent" : "note";
                    currentLineHtml += `<span class="${noteClass}">${note}</span>`;
                    if ((i + 1) % notesPerRow === 0 && i < totalNotes - 1) { currentLineHtml += '</div>'; finalHtmlOutput += currentLineHtml; currentLineHtml = '<div class="line">'; }
                    else if ((i + 1) % notesPerMeasure === 0 && i < totalNotes - 1) { currentLineHtml += '<span class="bar-line">|</span>'; } 
                    else if ((i + 1) % 4 === 0) { currentLineHtml += '<span class="sub-spacer"></span>'; }
                }
                currentLineHtml += '</div>';
                finalHtmlOutput += currentLineHtml;
                if(index < patternKeys.length - 1) { finalHtmlOutput += '<div class="variation-spacer"></div>'; }
            });
            finalHtmlOutput += `</div>`;
        }
        outputDiv.innerHTML = finalHtmlOutput;
    }

    function createInputStaff() {
        staffContainer.innerHTML = ''; 
        const totalNotes = notesPerMeasure * currentTotalMeasures;
        userAccents = new Array(totalNotes).fill(0);
        let noteCounter = 0;
        for (let m = 0; m < currentTotalMeasures; m++) {
            const measureDiv = document.createElement('div');
            measureDiv.classList.add('measure');
            for (let n = 0; n < notesPerMeasure; n++) {
                const noteContainer = document.createElement('div');
                noteContainer.classList.add('note-container');
                noteContainer.dataset.index = noteCounter;
                const accentMark = document.createElement('div');
                accentMark.classList.add('accent-mark');
                accentMark.innerHTML = '&gt;';
                const noteHead = document.createElement('div');
                noteHead.classList.add('note-head');
                const noteStem = document.createElement('div');
                noteStem.classList.add('note-stem');
                noteContainer.appendChild(accentMark);
                noteContainer.appendChild(noteHead);
                noteContainer.appendChild(noteStem);
                noteContainer.addEventListener('click', () => {
                    noteContainer.classList.toggle('accented');
                    const noteIndex = parseInt(noteContainer.dataset.index);
                    userAccents[noteIndex] = userAccents[noteIndex] === 0 ? 1 : 0;
                    renderExercise(); 
                    presetSelect.value = "Custom (Clear)";
                });
                measureDiv.appendChild(noteContainer);
                noteCounter++;
            }
            const beam1 = document.createElement('div');
            beam1.classList.add('beam', 'first-group');
            const beam2 = document.createElement('div');
            beam2.classList.add('beam', 'second-group');
            measureDiv.appendChild(beam1);
            measureDiv.appendChild(beam2);
            staffContainer.appendChild(measureDiv);
        }
    }
    
    function syncStaffUI() { const allNotes = staffContainer.querySelectorAll('.note-container'); allNotes.forEach((noteDiv, index) => { if (userAccents[index] === 1) { noteDiv.classList.add('accented'); } else { noteDiv.classList.remove('accented'); } }); }
    function applyPreset(presetName) { const presetPattern = melodyPresets[presetName]; const totalNotes = currentTotalMeasures * notesPerMeasure; for (let i = 0; i < totalNotes; i++) { userAccents[i] = presetPattern[i] || 0; } syncStaffUI(); renderExercise(); }
    function populatePresetSelector() { for (const name in melodyPresets) { const option = document.createElement('option'); option.value = name; option.textContent = name; presetSelect.appendChild(option); } }
    
    function initializeApp() {
        createInputStaff();
        renderExercise(); 
        const staffWidth = staffContainer.offsetWidth;
        outputDiv.style.width = `${staffWidth}px`;
        presetSelect.value = "Custom (Clear)";
    }
    
    buttons.forEach(button => {
        button.addEventListener('click', (e) => {
            buttons.forEach(btn => btn.classList.remove('active'));
            e.target.classList.add('active');
            currentTotalMeasures = parseInt(e.target.id.split('-')[1]);
            initializeApp();
        });
    });

    presetSelect.addEventListener('change', (e) => {
        applyPreset(e.target.value);
    });

    // YENƒ∞: PDF indirme butonu mantƒ±ƒüƒ± g√ºncellendi
    btnDownloadPdf.addEventListener('click', () => {
        const userTitle = pdfTitleInput.value.trim() || "My Awesome Exercise";
        
        // Ekranda g√∂r√ºnmeyen ba≈ülƒ±k div'ini doldur
        printHeader.innerHTML = `<span id="print-header-main">A&R+</span> <span id="print-header-user">${userTitle}</span>`;
        
        // Yazdƒ±rma i≈ülemini tetikle
        window.print();
    });
    
    populatePresetSelector();
    initializeApp();
    </script>
</body>
</html>